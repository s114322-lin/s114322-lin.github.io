<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI çŒœç•«è©•åˆ†æŒ‘æˆ°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f4f9; padding: 20px; }
        #canvas-container { 
            border: 5px solid #333; 
            display: inline-block; 
            background: white; 
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .controls { margin: 20px; }
        button { 
            padding: 15px 30px; font-size: 18px; cursor: pointer; 
            border-radius: 8px; border: none; margin: 5px;
        }
        .btn-score { background: #28a745; color: white; }
        .btn-clear { background: #dc3545; color: white; }
        #status { font-weight: bold; color: blue; margin: 10px; }
        #res { font-size: 24px; margin-top: 20px; font-weight: bold; color: #333; }
        #target-box { font-size: 30px; color: #e91e63; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ¨ AI ç•«ä½œè©•åˆ†å“¡</h1>
    <div id="status">æ¨¡å‹è®€å–ä¸­ï¼Œè«‹ç¨å€™...</div>
    <div id="target-box">é¡Œç›®ï¼š<span id="target-word">---</span></div>

    <div id="canvas-container"></div>
    
    <div class="controls">
        <button class="btn-clear" onclick="clearCanvas()">æ¸…ç©º</button>
        <button id="score-btn" class="btn-score" onclick="getScore()" disabled>è«‹å…ˆç­‰å¾…æ¨¡å‹è¼‰å…¥</button>
        <button onclick="nextQuestion()">æ›ä¸€é¡Œ</button>
    </div>

    <div id="res">ç­‰å¾…è©•åˆ†...</div>

    <script>
        let classifier;
        let canvas;
        let targetWord = "";
        const topics = ['cat', 'dog', 'flower', 'tree', 'car', 'apple', 'sun', 'moon', 'house', 'fish', 'umbrella', 'bird'];

        function setup() {
            // å»ºç«‹ç•«å¸ƒ
            canvas = createCanvas(400, 400);
            canvas.parent('canvas-container');
            background(255);
            
            // åˆå§‹åŒ– DoodleNet æ¨¡å‹
            classifier = ml5.imageClassifier('DoodleNet', modelReady);
            nextQuestion();
        }

        function modelReady() {
            console.log('Model Loaded!');
            document.getElementById('status').innerText = "âœ… AI æº–å‚™å¥½äº†ï¼å¯ä»¥é–‹å§‹ç•«ç•«";
            document.getElementById('status').style.color = "green";
            document.getElementById('score-btn').disabled = false;
            document.getElementById('score-btn').innerText = "ç•«å¥½äº†ï¼Œè«‹è©•åˆ†ï¼";
        }

        function nextQuestion() {
            targetWord = topics[Math.floor(Math.random() * topics.length)];
            document.getElementById('target-word').innerText = targetWord;
            document.getElementById('res').innerText = "ç­‰å¾…è©•åˆ†...";
            clearCanvas();
        }

        function clearCanvas() {
            background(255);
        }

        function draw() {
            if (mouseIsPressed) {
                stroke(0);
                strokeWeight(16); // ç·šæ¢ç²—ä¸€é» AI æ¯”è¼ƒå¥½èª
                line(pmouseX, pmouseY, mouseX, mouseY);
            }
        }

        function getScore() {
            document.getElementById('res').innerText = "AI æ­£åœ¨æ€è€ƒ...";
            
            // é€²è¡Œå½±åƒè¾¨è­˜
            classifier.classify(canvas, (err, results) => {
                if (err) {
                    console.error(err);
                    return;
                }
                
                console.log(results); // åœ¨é–‹ç™¼è€…å·¥å…·æŸ¥çœ‹æ‰€æœ‰çµæœ
                
                // æª¢æŸ¥ AI è¦ºå¾—é€™å¼µåœ–æœ€åƒä»€éº¼
                let topResult = results[0];
                let resBox = document.getElementById('res');

                // åˆ¤æ–·æ˜¯å¦èˆ‡é¡Œç›®ç›¸ç¬¦
                if (topResult.label.replace(/_/g, ' ') === targetWord) {
                    let score = (topResult.confidence * 100).toFixed(1);
                    resBox.innerText = `ğŸ‰ æ­å–œï¼é€™å°±æ˜¯ ${targetWord}ï¼ç›¸ä¼¼åº¦ï¼š${score}%`;
                    resBox.style.color = "green";
                } else {
                    resBox.innerText = `âŒ AI è¦ºå¾—é€™æ¯”è¼ƒåƒ [${topResult.label}]ï¼Œå†åŠ æ²¹ï¼`;
                    resBox.style.color = "red";
                }
            });
        }
    </script>
</body>
</html>
